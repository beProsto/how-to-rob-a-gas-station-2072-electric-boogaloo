<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>How To Rob A Gas Station 2072 - Electric Boogaloo</title>

	<style>
		body {
			background: black;
		}
	</style>

	<script>
		// Encapsulates logging (printing) functionality
		class Logger {
			constructor() {
				this.logBuffer = "";
				this.module = {};
			}
			printChar(ch) {
				const char = String.fromCharCode(ch);
				if (char == "\n") {
					console.log(this.logBuffer);
					this.logBuffer = "";
				}
				else {
					this.logBuffer += char;
				}
			}
			printString(str) {
				const mem = new Uint8Array(this.module.instance.exports.memory.buffer);
				for (let i = str; mem[i] != 0; i++) {
					this.printChar(mem[i]);
				}
			}
			printNumber(num) {
				this.logBuffer += String(num);
			}
		}

		// Entry point of the application
		window.onload = async () => {
			// const strToTxt = (strptr) => {
			//     const memory_buffer = new Uint8Array(wasmModule.instance.exports.memory.buffer, strptr, wasmModule.instance.exports.strlen(strptr));
			//     let text_buffer = new TextDecoder().decode(memory_buffer);
			//     return text_buffer;
			// };

			const logger = new Logger();

			const wasmModule = await WebAssembly.instantiateStreaming(
				fetch("./build/main.wasm"),
				{
					env: {
						// Printing (logging)
						env_ps: (s) => logger.printString(s),
						env_pn: (n) => logger.printNumber(n),
						env_pc: (c) => logger.printChar(c),
					}
				}
			);

			logger.module = wasmModule;

			wasmModule.instance.exports.main();
		};
	</script>
</head>

<body>

</body>

</html>